<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Konto verwalten | echtlucky</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/components.css" />
    <link rel="stylesheet" href="css/pages/account.css" />
  </head>
  <body class="page-transition account-page">
    <div id="header-placeholder"></div>

    <main class="account-main">
      <section class="account-wrap">
        <header class="account-hero">
          <div class="profile-card">
            <div class="profile-top">
              <div class="avatar avatar--editable" aria-label="Profilbild">
                <img id="avatarImg" class="avatar-img" alt="Profilbild" hidden />
                <div class="avatar-fallback" id="avatarInitial" aria-hidden="true">U</div>
                <input id="avatarFile" class="avatar-file" type="file" accept="image/*" hidden />
              </div>
              <div>
                <div class="profile-name" id="profileName">User</div>
                <div class="profile-email" id="profileEmail">—</div>
              </div>
            </div>

            <div class="profile-actions">
              <button class="btn btn-secondary" id="btnChangeAvatar" type="button">Profilbild ändern</button>
              <button class="btn btn-ghost" id="btnRemoveAvatar" type="button">Entfernen</button>
              <button class="btn btn-danger" id="btnSignOut" type="button">Ausloggen</button>
            </div>
          </div>

          <div class="account-hero__meta">
            <div class="pill" id="pillStatus">Status: …</div>
            <div class="pill" id="pillProvider">Provider: …</div>
            <div class="pill" id="pillUpdated">Updated: …</div>
          </div>
        </header>

        <section class="account-card" id="loggedOutCard" style="display:none;">
          <div class="card-head">
            <div>
              <h2 class="card-title">Du bist nicht eingeloggt</h2>
              <p class="card-hint">Log dich ein, damit dein Fortschritt im Account landet.</p>
            </div>
          </div>
          <div class="form-actions">
            <a class="btn btn-primary" href="login.html">Zum Login</a>
            <a class="btn btn-secondary" href="index.html">Zur Startseite</a>
          </div>
        </section>

        <section class="account-grid" id="accountGrid">
          <div class="account-card">
            <div class="card-head">
              <div>
                <h2 class="card-title">Ranked Stats</h2>
                <p class="card-hint">Dein aktueller Stand</p>
              </div>
              <div class="pill" id="chipSync">Sync: …</div>
            </div>

            <div class="stats-mini-grid">
              <div class="stat-tile">
                <div class="stat-label">Level</div>
                <div class="stat-value" id="rankedLevel"></div>
              </div>
              <div class="stat-tile">
                <div class="stat-label">XP</div>
                <div class="stat-value" id="rankedXp"></div>
              </div>
              <div class="stat-tile">
                <div class="stat-label">Streak</div>
                <div class="stat-value" id="rankedStreak"></div>
              </div>
              <div class="stat-tile">
                <div class="stat-label">Last</div>
                <div class="stat-value" id="rankedMeta"></div>
              </div>
            </div>

            <div class="chart-wrap">
              <h3 class="chart-title">Rank Verlauf</h3>
              <canvas id="rankChartCanvas" style="max-height: 250px;"></canvas>
            </div>
          </div>

          <div class="account-card">
            <div class="card-head">
              <div>
                <h2 class="card-title">Reflex Mode</h2>
                <p class="card-hint">Deine Reflex-Bestleistungen</p>
              </div>
            </div>

            <div class="stats-mini-grid">
              <div class="stat-tile">
                <div class="stat-label">Best Avg</div>
                <div class="stat-value" id="reflexAvg"></div>
              </div>
              <div class="stat-tile">
                <div class="stat-label">Best Hit</div>
                <div class="stat-value" id="reflexBest"></div>
              </div>
              <div class="stat-tile">
                <div class="stat-label">Rating</div>
                <div class="stat-value" id="reflexRating"></div>
              </div>
              <div class="stat-tile">
                <div class="stat-label">Last Run</div>
                <div class="stat-value" id="reflexLast"></div>
              </div>
            </div>
          </div>

          <div class="account-card">
            <div class="card-head">
              <div>
                <h2 class="card-title">Profil &amp; Account</h2>
                <p class="card-hint">Username, Email &amp; Preferences</p>
              </div>
            </div>

            <form id="accountSettingsForm" class="profile-form">
              <div class="form-group">
                <label for="inputUsername">Benutzername</label>
                <div class="form-input-group">
                  <input type="text" id="inputUsername" placeholder="Dein Benutzername" />
                  <span class="form-status" id="usernameStatus"></span>
                </div>
                <span class="form-hint" id="usernameHint">Öffentlich sichtbar • Änderbar alle 7 Tage</span>
              </div>

              <div class="form-group">
                <label for="inputEmail">Email Adresse</label>
                <div class="form-input-group">
                  <input type="email" id="inputEmail" placeholder="Deine Email" />
                  <span class="form-status" id="emailStatus"></span>
                </div>
                <span class="form-hint" id="emailHint">Du kannst deine Email ändern</span>
              </div>

              <div class="divider-line" aria-hidden="true"></div>

              <div class="form-group">
                <label for="prefFocusDefault">Focus Mode Default</label>
                <select id="prefFocusDefault">
                  <option value="off">Aus</option>
                  <option value="on">An</option>
                </select>
                <span class="form-hint">Gilt für Focus/Ranked UI (UI-only).</span>
              </div>

              <div class="form-group">
                <label for="prefDifficultyDefault">Difficulty Default</label>
                <select id="prefDifficultyDefault">
                  <option value="normal">Normal</option>
                  <option value="easy">Easy</option>
                  <option value="hard">Hard</option>
                </select>
                <span class="form-hint">Skaliert XP/Progress (UI-only).</span>
              </div>

              <div class="form-group">
                <label for="prefSounds">Sounds</label>
                <select id="prefSounds">
                  <option value="on">An</option>
                  <option value="off">Aus</option>
                </select>
                <span class="form-hint">Benachrichtigungen/Call-Sounds (UI-only).</span>
              </div>

              <div class="form-actions">
                <button type="submit" class="btn btn-primary" id="btnSaveSettings">Speichern</button>
                <button type="button" class="btn btn-secondary" id="btnCancelSettings">Abbrechen</button>
              </div>

              <div id="settingsFormMsg" class="form-msg"></div>
            </form>
          </div>

          <div class="account-card">
            <div class="card-head">
              <div>
                <h2 class="card-title">Status</h2>
                <p class="card-hint">Online-Status &amp; Custom Status (Connect)</p>
              </div>
            </div>

            <div class="profile-form" aria-label="Status Einstellungen">
              <div class="form-group">
                <label for="accountStatusSelect">Status</label>
                <select id="accountStatusSelect">
                  <option value="online">Online</option>
                  <option value="away">Abwesend</option>
                  <option value="dnd">Bitte nicht stören</option>
                  <option value="invisible">Unsichtbar</option>
                </select>
                <span class="form-hint">Wird in Connect angezeigt (Firestore).</span>
              </div>

              <div class="form-group">
                <label for="accountCustomStatus">Custom Status</label>
                <input id="accountCustomStatus" type="text" placeholder="z. B. 'Grinding Ranked' (optional)" maxlength="80" />
                <span class="form-hint">Kurzer Text unter deinem Namen (optional).</span>
              </div>

              <div class="form-actions">
                <button class="btn btn-primary" id="btnSaveStatus" type="button">Speichern</button>
                <button class="btn btn-secondary" id="btnClearStatus" type="button">Zurücksetzen</button>
              </div>

              <div id="statusFormMsg" class="form-msg"></div>
            </div>
          </div>

          <div class="account-card">
            <div class="card-head">
              <div>
                <h2 class="card-title">Security &amp; Login</h2>
                <p class="card-hint">E-Mail/Passwort, 2FA, Backup-Codes</p>
              </div>
            </div>

            <div class="profile-form" aria-label="Security Einstellungen">
              <div class="form-group">
                <label>Verknüpfte Logins</label>
                <div class="sync-info-box" style="margin-bottom:0;">
                  <div id="linkedProvidersList" style="display:grid; gap:8px;"></div>
                </div>
                <span class="form-hint">OAuth-Verknüpfungen (Google etc.) – future-ready.</span>
              </div>

              <div class="divider-line" aria-hidden="true"></div>

              <div class="form-actions">
                <button class="btn btn-secondary" id="btnChangeEmail" type="button">E-Mail ändern</button>
                <button class="btn btn-secondary" id="btnChangePassword" type="button">Passwort ändern</button>
              </div>

              <div class="divider-line" aria-hidden="true"></div>

              <div class="form-group">
                <label>2FA (Authenticator)</label>
                <div class="sync-info-box" style="margin-bottom:0;">
                  <p style="margin:0;">Vorbereitung (UI). TOTP/Authenticator-Flow wird später serverseitig finalisiert.</p>
                </div>
                <div class="form-actions" style="margin-top:.8rem;">
                  <button class="btn btn-secondary" id="btnSetup2fa" type="button">2FA einrichten</button>
                </div>
              </div>

              <div class="form-group">
                <label>Backup-Codes</label>
                <div class="form-actions" style="margin-bottom:.6rem;">
                  <button class="btn btn-secondary" id="btnGenerateBackupCodes" type="button">Backup-Codes generieren</button>
                  <button class="btn btn-ghost" id="btnCopyBackupCodes" type="button">Kopieren</button>
                </div>
                <textarea id="backupCodesBox" rows="5" readonly placeholder="(noch keine Codes generiert)"></textarea>
                <span class="form-hint">Codes werden lokal erzeugt. Speichere sie sicher.</span>
              </div>
            </div>
          </div>

          <div class="account-card">
            <div class="card-head">
              <div>
                <h2 class="card-title">Sessions &amp; Geräte</h2>
                <p class="card-hint">Aktive Session (Client) &amp; Übersicht</p>
              </div>
            </div>

            <div class="profile-form" aria-label="Sessions">
              <div class="sync-info-box">
                <div id="sessionsList" style="display:grid; gap:10px;"></div>
              </div>
              <div class="form-actions">
                <button class="btn btn-secondary" id="btnSignOutOtherSessions" type="button">Andere Sessions ausloggen</button>
              </div>
              <span class="form-hint">Browser-Session-Management ist eingeschränkt (Firebase Web). UI ist vorbereitet.</span>
            </div>
          </div>

          <div class="account-card">
            <div class="card-head">
              <div>
                <h2 class="card-title">Account Export</h2>
                <p class="card-hint">Exportiere deine Daten als JSON</p>
              </div>
            </div>

            <div class="form-actions">
              <button class="btn btn-secondary" id="btnExportAccount" type="button">Account exportieren</button>
              <button class="btn btn-secondary" id="btnExportAll" type="button">Alles exportieren (Local + Cloud)</button>
            </div>
          </div>

          <div class="account-card">
            <div class="card-head">
              <div>
                <h2 class="card-title">Daten Synchronisierung</h2>
                <p class="card-hint">Local • Cloud Sync</p>
              </div>
            </div>

            <div class="sync-info-box">
              <p>Synchronisiere deine Stats zwischen lokalem Gerät und Cloud-Account.</p>
            </div>

            <div class="sync-actions">
              <button class="btn btn-primary" id="btnUploadLocal" type="button">Local → Account</button>
              <button class="btn btn-secondary" id="btnDownloadCloud" type="button">Account → Local</button>
              <button class="btn btn-ghost" id="btnClearLocal" type="button">Local löschen</button>
            </div>

            <p class="mini-note">Account → Local überschreibt deine lokalen Werte.</p>
          </div>

          <div class="account-card">
            <div class="card-head">
              <div>
                <h2 class="card-title">Cloud Daten</h2>
                <p class="card-hint">Im Firestore gespeichert</p>
              </div>
            </div>

            <div class="preview">
              <div class="preview-row">
                <div class="preview-k">UID</div>
                <div class="preview-v" id="pvUid"></div>
              </div>
              <div class="preview-row">
                <div class="preview-k">Ranked</div>
                <div class="preview-v" id="pvRanked"></div>
              </div>
              <div class="preview-row">
                <div class="preview-k">Reflex</div>
                <div class="preview-v" id="pvReflex"></div>
              </div>
              <div class="preview-row">
                <div class="preview-k">Updated</div>
                <div class="preview-v" id="pvUpdated"></div>
              </div>
            </div>
          </div>

          <div class="account-card danger-card">
            <div class="card-head">
              <div>
                <h2 class="card-title">Danger Zone</h2>
                <p class="card-hint">Löschungen sind nicht rückgängig zu machen</p>
              </div>
            </div>

            <button class="btn btn-ghost danger" id="btnWipeCloud" type="button">Cloud Stats zurücksetzen</button>
            <button class="btn btn-danger" id="btnDeleteAccount" type="button" style="margin-top:10px;">Account löschen</button>
          </div>
        </section>
      </section>
    </main>

    <div id="footer-placeholder"></div>

    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-storage-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <script src="firebase.js"></script>
    <script src="js/auth-state.js"></script>
    <script src="js/menu.js"></script>
    <script src="js/legal-modal.js"></script>
    <script src="js/notify.js"></script>
    <script src="js/modal-dialog.js"></script>
    <script src="js/account.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        document.body.classList.add("loaded");

        fetch("header.html").then(r => r.text()).then(html => {
          document.getElementById("header-placeholder").innerHTML = html;
          if (typeof initHeaderScripts === "function") initHeaderScripts();
          if (typeof initSmartHeaderScroll === "function") initSmartHeaderScroll();
        }).catch(() => {});

        fetch("footer.html").then(r => r.text()).then(html => {
          document.getElementById("footer-placeholder").innerHTML = html;
        }).catch(() => {});
      });
    </script>
  </body>
</html>
