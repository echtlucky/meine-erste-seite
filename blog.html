<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blog | echtlucky</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* Pop-up für neuen Post (gleiches Design wie Registrierung) */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.75);
      backdrop-filter: blur(8px);
      z-index: 200;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .modal.show {
      display: flex;
      opacity: 1;
    }

    .modal-content {
      width: 100%;
      max-width: 700px;
      background: var(--card-bg);
      border: 1px solid rgba(0,255,136,0.3);
      border-radius: 24px;
      padding: 3rem 2.5rem;
      box-shadow: 0 10px 40px rgba(0,255,136,0.2);
      position: relative;
      text-align: center;
      transform: scale(0.8);
      opacity: 0;
      transition: transform 0.4s ease, opacity 0.4s ease;
    }

    .modal.show .modal-content {
      transform: scale(1);
      opacity: 1;
    }

    .modal-close {
      position: absolute;
      top: 1.5rem;
      right: 2rem;
      font-size: 2.5rem;
      color: var(--accent);
      cursor: pointer;
    }

    .modal h2 {
      color: var(--accent);
      font-size: 2.4rem;
      margin-bottom: 2rem;
    }

    .input-group {
      margin: 1.5rem 0;
      text-align: left;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
      color: #aaa;
    }

    input[type="text"],
    input[type="date"],
    textarea {
      width: 100%;
      padding: 1rem;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: rgba(255,255,255,0.03);
      color: var(--text);
      font-size: 1.1rem;
    }

    textarea {
      min-height: 250px;
      resize: vertical;
    }

    .btn-save {
      background: var(--accent);
      color: #000;
      width: 100%;
      padding: 1.2rem;
      font-size: 1.3rem;
      border-radius: 12px;
      margin-top: 2rem;
      box-shadow: 0 8px 30px rgba(0,255,136,0.3);
      transition: all 0.3s;
    }

    .btn-save:hover {
      background: var(--accent-hover);
      transform: translateY(-3px);
      box-shadow: 0 15px 50px rgba(0,255,136,0.5);
    }

    #post-status {
      margin-top: 1.5rem;
      text-align: center;
      font-size: 1.2rem;
      font-weight: bold;
    }
  </style>
</head>
<body class="page-transition">

<header>
  <a href="index.html" class="logo">echtlucky</a>

  <button class="menu-toggle" id="menuToggle">☰</button>

  <nav id="mainNav">
    <!-- Links zentriert in der Mitte -->
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="blog.html" class="active">Blog</a>
      <a href="index.html#stats">Stats</a>
      <a href="index.html#discord">Discord</a>
      <a href="index.html#twitch">Twitch</a>
    </div>

    <!-- Rechts: Nutzername + Dropdown oder Anmelden -->
    <div class="nav-right">
      <a href="login.html" id="login-link" style="color: var(--accent); font-weight: 600;">Anmelden</a>

      <div class="user-dropdown-wrapper">
        <span id="user-name-display" class="user-name" style="display:none;"></span>
        <div id="dropdown-menu" class="dropdown-menu">
          <a href="admin-panel.html" class="dropdown-item admin-panel" id="admin-panel-link" style="display:none;">Admin Panel</a>
          <a href="#" class="dropdown-item logout" onclick="logout()">Ausloggen</a>
        </div>
      </div>
    </div>
  </nav>
</header>

  <div class="container">
    <h1>Blog</h1>
    <p class="intro">Meine Gedanken, Erfahrungen und Tipps zum Ballistic- und Ranked-Grind.</p>

    <!-- Admin-Button – nur für dich sichtbar -->
    <div id="admin-button-wrapper" style="text-align: center; margin: 2rem 0 4rem; display: none;">
      <button class="btn" onclick="showPostModal()" style="background: #ff3366; color: white; font-size: 1.3rem; padding: 1.2rem 3rem;">
        Neuen Beitrag erstellen (Admin)
      </button>
    </div>

    <div class="blog-list">
      <div class="blog-card">
        <h2>Mein Ballistic-Setup 2026</h2>
        <p class="meta">22. Januar 2026 • Hardware, Settings, Trainings-Tools</p>
        <p>Mein aktueller Monitor, Maus, Sens, Software-Stack und was ich in den nächsten Monaten ändern will.</p>
        <a href="posts/post2.html" class="btn">Lesen</a>
      </div>

      <div class="blog-card">
        <h2>Mein Start in Ballistic – Erste Eindrücke</h2>
        <p class="meta">22. Januar 2026 • Erste Matches, Learnings & Ziele</p>
        <p>Was mir in den ersten Ballistic-Lobbys aufgefallen ist und wohin ich will.</p>
        <a href="posts/post1.html" class="btn">Lesen</a>
      </div>
    </div>
  </div>

  <!-- Pop-up für neuen Post -->
  <div id="postModal" class="modal">
    <div class="modal-content">
      <span class="modal-close" onclick="closePostModal()">×</span>
      <h2>Neuen Beitrag erstellen</h2>

      <div class="input-group">
        <input type="text" id="post-title" placeholder="Titel des Posts" required>
      </div>

      <div class="input-group">
        <textarea id="post-content" placeholder="Inhalt des Posts (HTML/Markdown erlaubt)" required></textarea>
      </div>

      <div class="input-group">
        <input type="date" id="post-date" required>
      </div>

      <button class="btn btn-login" onclick="savePost()">
        Post veröffentlichen
      </button>

      <p id="post-status" style="margin-top: 1.5rem; text-align: center;"></p>
    </div>
  </div>

  <footer>
    © 2026 echtlucky • Competitives Fortnite Journey • 
  </footer>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

  <script src="firebase.js"></script>

  <script src="js/menu.js"></script>

  <script>
    document.body.classList.add('loaded');

    function logout() {
      auth.signOut()
        .then(() => {
          alert('Erfolgreich ausgeloggt!');
          window.location.href = 'index.html';
        })
        .catch((err) => {
          alert('Ausloggen fehlgeschlagen: ' + err.message);
        });
    }

    // Prüfen, ob eingeloggt → Anmelden/Ausloggen + Nutzername + Dropdown + Admin-Button
    auth.onAuthStateChanged((user) => {
      const loginLink = document.getElementById('login-link');
      const logoutLink = document.getElementById('logout-link');
      const userNameDisplay = document.getElementById('user-name-display');
      const dropdownMenu = document.getElementById('dropdown-menu');
      const adminPanelLink = document.getElementById('admin-panel-link');
      const adminWrapper = document.getElementById('admin-button-wrapper');

      if (user) {
        // Eingeloggt
        if (loginLink) loginLink.style.display = 'none';
        if (logoutLink) logoutLink.style.display = 'inline-block';

        if (userNameDisplay) {
          userNameDisplay.textContent = user.displayName || user.email.split('@')[0];
          userNameDisplay.style.display = 'inline-block';
        }

        // Admin-Button (Blog-Seite)
        if (adminWrapper && user.email === "lucassteckel04@gmail.com") {
          adminWrapper.style.display = 'block';
        }

        // Admin-Link im Dropdown
        if (adminPanelLink && user.email === "lucassteckel04@gmail.com") {
          adminPanelLink.style.display = 'block';
        }
      } else {
        // Ausgeloggt
        if (loginLink) loginLink.style.display = 'inline-block';
        if (logoutLink) logoutLink.style.display = 'none';
        if (userNameDisplay) userNameDisplay.style.display = 'none';
        if (dropdownMenu) dropdownMenu.classList.remove('show');
        if (adminPanelLink) adminPanelLink.style.display = 'none';
        if (adminWrapper) adminWrapper.style.display = 'none';
      }
    });

    // Hover → Dropdown öffnen/schließen
    const userNameDisplay = document.getElementById('user-name-display');
    const dropdownMenu = document.getElementById('dropdown-menu');

    if (userNameDisplay && dropdownMenu) {
      userNameDisplay.addEventListener('mouseenter', () => {
        dropdownMenu.classList.add('show');
      });

      document.addEventListener('click', (e) => {
        if (!userNameDisplay.contains(e.target) && !dropdownMenu.contains(e.target)) {
          dropdownMenu.classList.remove('show');
        }
      });
    }

    // Pop-up für neuen Post
    const postModal = document.getElementById('postModal');
    const postStatus = document.getElementById('post-status');

    function showPostModal() {
      postModal.style.display = 'flex';
      setTimeout(() => postModal.classList.add('show'), 10);
      postStatus.textContent = '';
    }

    function closePostModal() {
      postModal.classList.remove('show');
      setTimeout(() => postModal.style.display = 'none', 400);
    }

    postModal.addEventListener('click', (e) => {
      if (e.target === postModal) closePostModal();
    });

    // Post speichern
    function savePost() {
      const title = document.getElementById('post-title').value.trim();
      const content = document.getElementById('post-content').value.trim();
      const date = document.getElementById('post-date').value;

      if (!title || !content || !date) {
        postStatus.textContent = 'Bitte alle Felder ausfüllen';
        postStatus.style.color = 'red';
        return;
      }

      const postData = {
        title,
        content,
        date,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        author: auth.currentUser.email
      };

      db.collection('posts').add(postData)
        .then(() => {
          postStatus.textContent = 'Post gespeichert!';
          postStatus.style.color = 'lime';
          // Felder leeren
          document.getElementById('post-title').value = '';
          document.getElementById('post-content').value = '';
          closePostModal();
        })
        .catch((err) => {
          postStatus.textContent = 'Fehler: ' + err.message;
          postStatus.style.color = 'red';
        });
    }
  </script>

</body>
</html>