<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Connect | echtlucky</title>

  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/components.css" />
  <link rel="stylesheet" href="css/pages/connect.css" />
</head>

<body class="page-transition connect-page">
  <!-- Header via fetch -->
  <div id="header-placeholder"></div>

  <main class="container connect-shell">

    <!-- FRIENDS ONLINE SECTION -->
    <section class="friends-online" id="friendsOnlineSection" style="display:none;">
      <div class="friends-online__header">
        <h3 class="friends-online__title">ğŸ‘¥ Freunde online</h3>
        <div class="friends-online__list" id="friendsOnlineList">
          <!-- Dynamically populated -->
        </div>
      </div>
    </section>

    <!-- HERO SECTION -->
    <section class="connect-hero">
      <div class="connect-hero__inner">
        <div class="connect-badge">âš¡ echtlucky â€¢ Community</div>
        <h1 class="connect-title">Connect</h1>
        <p class="connect-sub">
          Echte Community, echter Grind. Gruppen, Chat, Voice â€” alles auf der Seite.
        </p>

        <!-- Auth Status Card -->
        <div class="auth-status-card" id="authStatusCard">
          <div class="auth-status-content">
            <span class="status-label" id="statusLabel">Nicht eingeloggt</span>
            <a href="login.html" class="btn btn-primary" id="btnLogin">Anmelden</a>
          </div>
        </div>
      </div>
    </section>

    <!-- GROUPS SECTION -->
    <section class="connect-card" id="groupsSection">
      <div class="card-head">
        <div>
          <h2 class="card-title">Deine Gruppen</h2>
          <p class="card-hint">Tritt einer Gruppe bei oder erstelle eine neue.</p>
        </div>
        <button class="btn btn-primary btn-sm" id="btnCreateGroup">+ Neue Gruppe</button>
      </div>

      <div class="groups-container" id="groupsContainer">
        <div class="empty-state">
          <p>ğŸ“­ Noch keine Gruppen</p>
          <small>Erstelle eine neue Gruppe um zu starten</small>
        </div>
      </div>
    </section>

    <!-- SELECTED GROUP SECTION -->
    <section class="connect-card" id="selectedGroupSection" style="display:none;">
      <div class="card-head">
        <div>
          <h2 class="card-title" id="groupTitle">Gruppe laden...</h2>
          <p class="card-hint" id="groupDesc">WÃ¤hle einen Tab aus</p>
        </div>
      </div>

      <!-- TAB NAVIGATION -->
      <div class="group-tabs">
        <button class="tab-btn is-active" data-tab="chat">ğŸ’¬ Chat</button>
        <button class="tab-btn" data-tab="members">ğŸ‘¥ Members</button>
        <button class="tab-btn" data-tab="voice">ğŸ¤ Voice</button>
        <button class="tab-btn" data-tab="settings">âš™ï¸ Einstellungen</button>
      </div>

      <!-- CHAT TAB -->
      <div class="tab-content is-active" data-tab="chat">
        <div class="chat-box">
          <div class="messages-list" id="messagesList"></div>
          <div class="chat-input-area">
            <input type="text" id="messageInput" class="message-input" placeholder="Nachricht..." disabled />
            <button class="btn btn-primary btn-sm" id="btnSendMessage" disabled>Senden</button>
          </div>
        </div>
      </div>

      <!-- MEMBERS TAB -->
      <div class="tab-content" data-tab="members">
        <div class="members-grid" id="membersList"></div>
      </div>

      <!-- VOICE TAB -->
      <div class="tab-content" data-tab="voice">
        <div class="voice-section">
          <div class="voice-status" id="voiceStatus">Nicht im Call</div>
          <div class="voice-buttons">
            <button class="btn btn-primary" id="btnStartVoice">ğŸ¤ Voice starten</button>
            <button class="btn btn-danger" id="btnEndVoice" style="display:none;">â˜ï¸ Beenden</button>
          </div>
          <div class="voice-participants" id="voiceParticipants"></div>
        </div>
      </div>

      <!-- SETTINGS TAB -->
      <div class="tab-content" data-tab="settings">
        <div class="settings-section">
          <h3>Gruppeneinstellungen</h3>
          <div class="setting-item">
            <label>Gruppenlevel</label>
            <input type="text" id="groupLevel" disabled />
          </div>
          <div class="setting-item">
            <button class="btn btn-secondary" id="btnLeaveGroup">Gruppe verlassen</button>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- Footer via fetch -->
  <div id="footer-placeholder"></div>

  <!-- FIREBASE CDN (Compat v10.14.1) -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

  <!-- SCRIPTS -->
  <script src="firebase.js"></script>
  <script src="js/menu.js"></script>
  <script src="js/auth-state.js"></script>
  <script src="js/notify.js"></script>
  <script src="js/connect-minimal.js"></script>
  <script src="js/connect.js"></script>
  <script src="js/voice-chat.js"></script>

  <!-- POST-LOAD HEADER INIT -->
  <script>
    document.body.classList.add('loaded');

    // Header laden (mit cache-buster)
    fetch('header.html?v=' + Date.now())
      .then(r => r.text())
      .then(html => {
        document.getElementById('header-placeholder').innerHTML = html;
        if (typeof initHeaderScripts === "function") initHeaderScripts();
        if (typeof initSmartHeaderScroll === "function") initSmartHeaderScroll();
        // Trigger auth-state.js to apply header UI
        window.dispatchEvent(new CustomEvent('echtlucky:header-ready'));
      });

    // Footer laden (mit cache-buster)
    fetch('footer.html?v=' + Date.now())
      .then(r => r.text())
      .then(html => {
        document.getElementById('footer-placeholder').innerHTML = html;
      });

    // TAB SWITCHING
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', e => {
        const tabName = e.target.dataset.tab;
        
        // Update buttons
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('is-active'));
        e.target.classList.add('is-active');
        
        // Update content
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('is-active'));
        document.querySelector(`.tab-content[data-tab="${tabName}"]`).classList.add('is-active');
      });
    });
  </script>

</body>
</html>